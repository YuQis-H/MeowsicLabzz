@page "/admin/moods"
@using Microsoft.AspNetCore.Authorization
@using Microsoft.EntityFrameworkCore
@attribute [Authorize(Roles = "Administrator")]
@inject MeowsicLabzz.Data.ApplicationDbContext Db
@inject NavigationManager NavigationManager

<h3>🎭 Manage Moods</h3>
<button type="button" class="btn btn-secondary mb-3" @onclick="GoBack">← Back to Admin</button>

<div class="mb-3">
 <input class="form-control" placeholder="New mood name" @bind="newName" />
 <button class="btn btn-primary mt-2" @onclick="AddMood">Add Mood</button>
</div>

@if (moods is null)
{
 <p><em>Loading...</em></p>
}
else if (!moods.Any())
{
 <p>No moods found.</p>
}
else
{
 <table class="table table-sm">
 <thead>
 <tr>
 <th>Id</th>
 <th>Name</th>
 <th></th>
 </tr>
 </thead>
 <tbody>
 @foreach (var m in moods)
 {
 <tr>
 <td>@m.Id</td>
 <td>@m.Name</td>
 <td>
 <button class="btn btn-danger btn-sm" @onclick="() => DeleteMood(m.Id)">Delete</button>
 </td>
 </tr>
 }
 </tbody>
 </table>
}

@code {
 private List<MeowsicLabzz.Components.Domain.Mood>? moods;
 private string? newName;

 protected override async Task OnInitializedAsync()
 {
 await LoadMoods();
 }

 private async Task LoadMoods()
 {
 moods = await Db.Moods.OrderBy(m => m.Id).ToListAsync();
 StateHasChanged();
 }

 private async Task AddMood()
 {
 if (string.IsNullOrWhiteSpace(newName))
 return;

 var mood = new MeowsicLabzz.Components.Domain.Mood { Name = newName.Trim() };
 Db.Moods.Add(mood);
 await Db.SaveChangesAsync();
 newName = string.Empty;
 await LoadMoods();
 }

 private async Task DeleteMood(int id)
 {
 var entity = await Db.Moods.FindAsync(id);
 if (entity is null) return;
 Db.Moods.Remove(entity);
 await Db.SaveChangesAsync();
 await LoadMoods();
 }

 private void GoBack()
 {
 NavigationManager.NavigateTo("/admin");
 }
}